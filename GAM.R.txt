
install.packages("mgcv")
install.packages("gratia")
install.packages("ggplot2")


library(mgcv)
library(gratia)
library(ggplot2)


data <- read.csv("XX facter.csv")

response <- "Microbial_Shannon"
predictors <- names(data)[names(data) != response]


pdf_file <- "GAM_Nonlinear_Effects.pdf"


pdf(pdf_file, width = 7, height = 5)


for (var in predictors) {
  formula <- as.formula(paste(response, "~ s(", var, ")", sep = ""))
  gam_model <- gam(formula, data = data, method = "REML")
  
  p <- draw(gam_model) + 
    ggtitle(paste("Nonlinear Effect of", var, "on Microbial Diversity")) +
    theme_minimal(base_size = 14)
  
  print(p)
}


dev.off()


